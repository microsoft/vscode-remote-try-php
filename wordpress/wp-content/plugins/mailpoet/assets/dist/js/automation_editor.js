"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[392],{7878:(e,t,a)=>{var i=a(26372),o=a.n(i),s=a(2226),n=a(70079),r=a(81731),l=a(9234),c=a(71575),d=a(51144),m=a(82132),u=a(50364),p=a(79527),h=a(65555),b=a(4308),g=a(28210),v=a(55887),x=a(21899),_=a(47107),j=a(58288),f=a(89912),S=a(71143),y=(a(20644),a(35250)),N=a(42741),w=a(71111);function k(){const{isSidebarOpened:e,selectedStep:t,savedState:a}=(0,p.Z)((e=>({isSidebarOpened:e(w.storeName).isSidebarOpened,selectedStep:e(w.storeName).getSelectedStep,savedState:e(w.storeName).getSavedState()}))),{openSidebar:i,closeSidebar:o,save:s,toggleFeature:r}=(0,N.Z)(w.storeName),{registerShortcut:l}=(0,N.Z)(x.h);return(0,n.useEffect)((()=>{l({name:"mailpoet/automation-editor/toggle-fullscreen",category:"global",description:(0,_.__)("Toggle fullscreen mode.","mailpoet"),keyCombination:{modifier:"secondary",character:"f"}}),l({name:"mailpoet/automation-editor/toggle-sidebar",category:"global",description:(0,_.__)("Show or hide the settings sidebar.","mailpoet"),keyCombination:{modifier:"primaryShift",character:","}}),l({name:"mailpoet/automation-editor/save",category:"global",description:(0,_.__)("Save your changes.","mailpoet"),keyCombination:{modifier:"primary",character:"s"}})}),[l]),(0,x.bx)("mailpoet/automation-editor/toggle-fullscreen",(()=>{r("fullscreenMode")})),(0,x.bx)("mailpoet/automation-editor/toggle-sidebar",(a=>{if(a.preventDefault(),e())o();else{const e=t()?w.stepSidebarKey:w.automationSidebarKey;i(e)}})),(0,x.bx)("mailpoet/automation-editor/save",(e=>{e.preventDefault(),"unsaved"===a&&s()})),null}var Z=a(41159),A=a(68262),D=a(50949),C=a(13792);const{lock:I,unlock:T}=(0,C.es)("I know using unstable features means my theme or plugin will inevitably break in the next version of WordPress.","@wordpress/edit-post"),{Tabs:P}=T(D.Y),L=n.forwardRef((function(e,t){return(0,y.jsxs)(P.TabList,{ref:t,children:[(0,y.jsx)(P.Tab,{tabId:w.automationSidebarKey,children:(0,_.__)("Automation","mailpoet")}),(0,y.jsx)(P.Tab,{tabId:w.stepSidebarKey,children:(0,_.__)("Step","mailpoet")})]})}));var E=a(20809),O=a(87889),K=a(47294),F=a(48927),V=a(66276);function W({title:e,description:t,icon:a}){return(0,y.jsxs)("div",{className:"block-editor-block-card",children:[(0,y.jsx)(V.Z,{icon:a}),(0,y.jsxs)("div",{className:"block-editor-block-card__content",children:[(0,y.jsx)("h2",{className:"block-editor-block-card__title",children:e}),(0,y.jsx)("span",{className:"block-editor-block-card__description",children:t})]})]})}function M(){const{errors:e}=(0,p.Z)((e=>({errors:e(w.storeName).getStepError(e(w.storeName).getSelectedStep().id)})),[]);if(!e||!e?.fields)return null;const t=e.fields?.general;return t?(0,y.jsx)(E.Z,{isDismissible:!1,status:"error",children:t}):null}function B(){const{selectedStep:e,selectedStepType:t}=(0,p.Z)((e=>({selectedStep:e(w.storeName).getSelectedStep(),selectedStepType:e(w.storeName).getSelectedStepType()})),[]);if(!e)return(0,y.jsx)(O.ZP,{children:"No step selected."});if(!t)return(0,y.jsx)(O.ZP,{children:"Unknown step type."});const a=t.edit;return(0,y.jsxs)("div",{className:"block-editor-block-inspector",children:[(0,y.jsx)(M,{}),(0,y.jsx)(W,{title:t.title(e,"sidebar"),description:t.description(e,"sidebar"),icon:t.icon}),(0,y.jsx)(a,{},e.id),"trigger"===e.type&&(0,y.jsx)(F.G9,{strings:K.E})]})}var R=a(42570),Y=a(77309),G=a(74325),q=a(84209);function z(){const e=q.Hooks.applyFilters("mailpoet.automation.settings.render",{});return 0===Object.keys(e).length?null:(0,y.jsx)(O.ZP,{title:(0,_.__)("Automation settings","mailpoet"),initialOpen:!0,children:Object.keys(e).map((t=>(0,y.jsx)(R.Z,{children:e[t]},t)))})}function H(){const{automationData:e}=(0,p.Z)((e=>({automationData:e(w.storeName).getAutomationData()})),[]),t={year:"numeric",month:"long",day:"numeric"};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(O.ZP,{title:(0,_.__)("Automation details","mailpoet"),initialOpen:!0,children:[(0,y.jsxs)(R.Z,{children:[(0,y.jsx)("strong",{children:"Date added"})," ",new Date(Date.parse(e.created_at)).toLocaleDateString(G.locale.toString(),t)]}),(0,y.jsxs)(R.Z,{children:[(0,y.jsx)("strong",{children:"Activated"})," ","active"===e.status&&new Date(Date.parse(e.updated_at)).toLocaleDateString(G.locale.toString(),t),"active"!==e.status&&e.activated_at&&new Date(Date.parse(e.activated_at)).toLocaleDateString(G.locale.toString(),t),"active"!==e.status&&!e.activated_at&&(0,y.jsx)("span",{className:"mailpoet-deactive",children:"Not activated yet."})]}),(0,y.jsxs)(R.Z,{children:[(0,y.jsx)("strong",{children:"Author"})," ",e.author.name]}),(0,y.jsx)(R.Z,{children:(0,y.jsx)(Y.Q,{})})]}),(0,y.jsx)(z,{})]})}const{Tabs:Q}=T(D.Y),U=b.Z.select({web:!0,native:!1});function J(e){const{keyboardShortcut:t,sidebarKey:a,showIconLabels:i,automationName:o}=(0,p.Z)((e=>({keyboardShortcut:e(x.h).getShortcutRepresentation("mailpoet/automation-editor/toggle-sidebar"),sidebarKey:e(v.h).getActiveComplementaryArea(w.storeName)??w.automationSidebarKey,showIconLabels:e(w.storeName).isFeatureActive("showIconLabels"),automationName:e(w.storeName).getAutomationData().name})),[]),s=(0,n.useRef)(null),r=(0,n.useContext)(Q.Context);return(0,y.jsx)(v.Vi,{identifier:a,header:(0,y.jsx)(Q.Context.Provider,{value:r,children:(0,y.jsx)(L,{ref:s})}),closeLabel:(0,_.__)("Close settings","mailpoet"),headerClassName:"editor-sidebar__panel-tabs",title:(0,_.__)("Settings","mailpoet"),icon:A.Z,className:"edit-site-sidebar mailpoet-automation-sidebar",panelClassName:"edit-site-sidebar",smallScreenTitle:o||(0,_.__)("(no title)","mailpoet"),scope:w.storeName,toggleShortcut:t,isActiveByDefault:U,showIconLabels:i,...e,children:(0,y.jsxs)(Q.Context.Provider,{value:r,children:[(0,y.jsx)(Q.TabPanel,{tabId:w.automationSidebarKey,children:(0,y.jsx)(H,{})}),(0,y.jsx)(Q.TabPanel,{tabId:w.stepSidebarKey,children:(0,y.jsx)(B,{})})]})})}function X(e){const{openSidebar:t}=(0,N.Z)(w.storeName),{sidebarKey:a}=(0,p.Z)((e=>({sidebarKey:e(v.h).getActiveComplementaryArea(w.storeName)??w.automationSidebarKey})),[]);return(0,y.jsx)(Q,{selectedTabId:a,onSelect:t,children:(0,y.jsx)(J,{...e})})}var $=a(75233),ee=a(96854),te=a(69177),ae=a(55382),ie=a(91172),oe=a(55064),se=a(82505),ne=a(26462);function re({onClose:e}){const[t,a]=(0,n.useState)(!1),{activate:i}=(0,N.Z)(w.storeName);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"mailpoet-automation-activate-panel__header",children:[(0,y.jsx)("div",{className:"mailpoet-automation-activate-panel__header-activate-button",children:(0,y.jsxs)(l.ZP,{variant:"primary",disabled:t,isBusy:t,autoFocus:!t,onClick:()=>{a(!0),i()},children:[t&&(0,_.__)("Activating…","mailpoet"),!t&&(0,_.__)("Activate","mailpoet")]})}),(0,y.jsx)("div",{className:"mailpoet-automation-activate-panel__header-cancel-button",children:(0,y.jsx)(l.ZP,{variant:"secondary",onClick:e,disabled:t,children:(0,_.__)("Cancel","mailpoet")})})]}),t&&(0,y.jsx)("div",{className:"mailpoet-automation-activate-panel__body",children:(0,y.jsx)(oe.ZP,{})}),!t&&(0,y.jsxs)("div",{className:"mailpoet-automation-activate-panel__body",children:[(0,y.jsx)("p",{children:(0,y.jsx)("strong",{children:(0,_.__)("Are you ready to activate?","mailpoet")})}),(0,y.jsx)("p",{children:(0,_.__)("Double-check your settings before activating.","mailpoet")})]})]})}function le({onClose:e}){const{automation:t}=(0,p.Z)((e=>({automation:e(w.storeName).getAutomationData()})),[]);return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"mailpoet-automation-activate-panel__header",children:(0,y.jsx)(l.ZP,{icon:se.Z,onClick:e,label:(0,_.__)("Close","mailpoet")})}),(0,y.jsxs)("div",{className:"mailpoet-automation-activate-panel__body",children:[(0,y.jsx)("div",{className:"mailpoet-automation-activate-panel__section",children:(0,_.sprintf)((0,_.__)('"%s" is now live.',"mailpoet"),t.name)}),(0,y.jsx)("p",{children:(0,y.jsx)("strong",{children:(0,_.__)("What’s next?","mailpoet")})}),(0,y.jsx)("p",{children:(0,_.__)("View all your automations to track statistics and create new ones.","mailpoet")}),(0,y.jsx)(l.ZP,{variant:"secondary",onClick:()=>{window.location.href=te.MailPoet.urls.automationListing},children:(0,_.__)("View all automations","mailpoet")})]})]})}function ce(){const{automation:e,errors:t}=(0,p.Z)((e=>({errors:e(w.storeName).getErrors(),automation:e(w.storeName).getAutomationData()})),[]),{closeActivationPanel:a}=(0,N.Z)(w.storeName);if((0,n.useEffect)((()=>{t&&a()}),[t,a]),t)return null;const i=e.status===ne.b.ACTIVE;return(0,y.jsxs)("div",{className:"mailpoet-automation-activate-panel",children:[i&&(0,y.jsx)(le,{onClose:a}),!i&&(0,y.jsx)(re,{onClose:a})]})}var de=a(32539);function me(e){return"saved"!==(0,m.Y)(w.storeName).getSavedState()?(e.returnValue=(0,_.__)("There are unsaved changes that will be lost. Do you want to continue?","mailpoet"),e.returnValue):""}function ue(){const{isFullscreenActive:e,isInserterOpened:t,isActivationPanelOpened:a,isSidebarOpened:i,showIconLabels:s,automation:h}=(0,p.Z)((e=>({isFullscreenActive:e(w.storeName).isFeatureActive("fullscreenMode"),isInserterOpened:e(w.storeName).isInserterSidebarOpened(),isSidebarOpened:e(w.storeName).isSidebarOpened(),isActivationPanelOpened:e(w.storeName).isActivationPanelOpened(),showIconLabels:e(w.storeName).isFeatureActive("showIconLabels"),automation:e(w.storeName).getAutomationData()})),[]),[b,f]=(0,n.useState)(!0);if((0,n.useEffect)((()=>(window.addEventListener("beforeunload",me),()=>window.removeEventListener("beforeunload",me))),[]),(0,n.useEffect)((()=>{b&&("trash"===h.status&&(window.location.href=(0,j.f)(te.MailPoet.urls.automationListing,{notice:ae.f.automationHadBeenDeleted,"notice-args":[h.name]})),function(){const e=(0,m.Y)(w.storeName).getAutomationData();if(![ne.b.ACTIVE,ne.b.DEACTIVATING].includes(e.status))return;if(0===e.stats.totals.in_progress)return;const{createNotice:t}=(0,u.W)(d.store);t("success",(0,_.__)("Editing an active automation is temporarily unavailable. We are working on introducing this functionality.","mailpoet"),{type:"snackbar"})}(),f(!1))}),[h.name,h.status,b]),"trash"===h.status)return null;const N=o()("interface-interface-skeleton",{"is-sidebar-opened":i,"show-icon-labels":s});return(0,y.jsx)(x.vn,{children:(0,y.jsxs)(r.zt,{children:[(0,y.jsx)(v.x4,{isActive:e}),(0,y.jsx)(k,{}),(0,y.jsx)(X,{}),(0,y.jsx)(v.v4,{className:N,drawer:e&&(0,y.jsx)("div",{className:"edit-site-navigation-toggle",children:(0,y.jsx)(l.ZP,{className:"edit-site-navigation-toggle__button has-icon",href:"admin.php?page=mailpoet-automation",children:(0,y.jsx)(c.Z,{size:36,icon:g.Z})})}),header:(0,y.jsx)(S.h4,{showInserterToggle:!1}),content:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(Z.s,{}),(0,y.jsx)($.q,{context:"edit"})]}),sidebar:(0,y.jsx)(v.Vi.Slot,{scope:w.storeName}),secondarySidebar:null}),a&&(0,y.jsx)(ce,{})]})})}window.addEventListener("DOMContentLoaded",(()=>{if((0,_.setLocaleData)(window.wp.i18n.getLocaleData()),void 0!==window.wp.date.getSettings){const e=window.wp;(0,h.setSettings)(e.date.getSettings())}else{const e=window.wp;(0,h.setSettings)(e.date.__experimentalGetSettings())}(0,w.createStore)();const e=b.Z.select({web:!0,native:!1});(0,u.W)(v.h).enableComplementaryArea(w.storeName,e?w.automationSidebarKey:void 0);const t=document.getElementById("mailpoet_automation_editor");t&&((0,f.registerTranslations)(),ie.default.use((async(e,t)=>{try{return await t(e)}catch(t){if(e.signal?.aborted)return;const a=t,i=a.data?.status;if("mailpoet_automation_not_valid"===a.code)return void(0,u.W)(w.storeName).setErrors({steps:a.data.errors});if(i&&i>=400&&i<500){const e=a.message;return(0,u.W)(d.store).createErrorNotice(e??(0,_.__)("An unknown error occurred.","mailpoet"),{explicitDismiss:!0}),void(0,u.W)(w.storeName).setErrors({steps:[]})}throw(0,u.W)(d.store).createErrorNotice((0,_.__)("An unknown error occurred.","mailpoet"),{explicitDismiss:!0}),t}})),(0,ee.q)(),(0,de.R)(),(0,s.s)(t).render((0,y.jsx)(ue,{})))}))},65311:e=>{e.exports=jQuery}},e=>{e.O(0,[351],(()=>(7878,e(e.s=7878)))),e.O()}]);