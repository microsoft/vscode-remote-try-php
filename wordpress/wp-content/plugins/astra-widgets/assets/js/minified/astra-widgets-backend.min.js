!function(l){AstraWidgets={init:function(){this._init_colorpicker(),this._init_repeater(),this._getMarkup(),this._bind()},_init_colorpicker:function(){l(".astra-widget-field-color .astra-widget-color > input").not('[id*="__i__"]').wpColorPicker({change:function(e,t){l(e.target).val(t.color.toString()),l(e.target).trigger("change")}})},_bind:function(){l(document).on("widget-updated widget-added",AstraWidgets._reinit_controls),l(document).on("click",".astra-select-icon",AstraWidgets._icon_selector),l(document).on("click",".astra-widget-icon",AstraWidgets._set_icon),l(document).on("click",".astra-repeater-sortable .clone",AstraWidgets._repeater_clone),l(document).on("click",".astra-repeater-sortable .remove",AstraWidgets._repeater_remove),l(document).on("click",".astra-repeater-field .actions",AstraWidgets._repeater_toggle_open),l(document).on("click",".astra-repeater .add-new-btn",AstraWidgets._add_new),l(document).on("click",".widget-control-save",AstraWidgets._repeater_reinit),l(document).on("click",".astra-repeater-field .astra-select-image",AstraWidgets._repeater_add_image_field),l(document).on("click",".astra-repeater-field .astra-remove-image",AstraWidgets._repeater_remove_image_field),l(document).on("input",'.astra-repeater-field [data-field-id="title"]',AstraWidgets._repeater_set_title),l(document).on("keyup",".astra-repeater-field .search-icon",AstraWidgets._searchFuntionality),l(document).on("click",".astra-repeater-field .astra-select-icon",AstraWidgets._showIconsMarkup)},_reinit_controls:function(){AstraWidgets._init_colorpicker(),AstraWidgets._init_repeater()},_getMarkup:function(){var e,t,a,s,i,r=fontAwesomeIcons.font_awesome,n='<input type="search" placeholder="Search icon..." class="search-icon">';for(e in n+='<ul class="astra-widget-icons-list">',r)r.hasOwnProperty(e)&&(i=((t=r[e]).svg.hasOwnProperty("brands")?t.svg.brands:t.svg.solid).viewBox,a=(t.svg.hasOwnProperty("brands")?t.svg.brands:t.svg.solid).path,s=i.join(" "),i=t.search.terms.join(" "),t.search.terms.push(e),t.search.terms.push(t.styles[0]),n+='<li class="astra-widget-icon '+e+'" data-search-terms="'+i+'" data-font="'+e+'" data-viewbox="'+s+'" data-path="'+a+'">',n+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+s+'"><path d="'+a+'"></path></svg>',n+="</li>");return n+="</ul>"},_showIconsMarkup:function(){font_awesome_markup=AstraWidgets._getMarkup(),l(this).hasClass("open")?l(this).parents(".astra-widget-icon-selector").find(".astra-icons-list-wrap").append(font_awesome_markup):(l(this).parents(".astra-widget-icon-selector").find(".astra-widget-icons-list").remove(),l(this).parents(".astra-widget-icon-selector").find(".search-icon").remove())},_icon_selector:function(e){l(this).parents(".astra-widget-icon-selector").find(".astra-icons-list-wrap").slideToggle(),l(this).toggleClass("open")},_set_icon:function(e){var t=l(this).parents(".astra-widget-icon-selector"),a=l(this).attr("data-font")||"",s=t.find(".astra-widget-icon."+a),i=t.find(".astra-selected-icon"),r=t.find(".selected-icon"),n=l(this).attr("data-path"),o=l(this).attr("data-viewbox"),d=s.html();i.html(d),t.find(".astra-widget-icons-list .astra-widget-icon").removeClass("selected"),s.addClass("selected"),"yes"===l(this).closest(".astra-repeater-field").find(".selected-icon").data("icon-visible")&&(l(this).closest(".astra-repeater-field").find(".title").attr("class","title"),l(this).closest(".astra-repeater-field").find(".title").addClass(a)),iconObj={name:a,path:n,viewbox:o};o=JSON.stringify(iconObj);r.val(o),t.find(".selected-icon").trigger("change")},_searchFuntionality:function(){var e,t,a=this.value.toUpperCase(),s=l(this).parents(".astra-icons-list-wrap").find(".astra-widget-icons-list")[0];setTimeout(function(){for(e=s.getElementsByTagName("li"),t=0;t<e.length;t++)search=l(e[t]).data("search-terms"),search&&(-1<search.toUpperCase().indexOf(a)?e[t].style.display="":e[t].style.display="none")},300)},_repeater_remove_image_field:function(e){var t;confirm("Do you want to remove this image?")&&((t=l(this).parents(".astra-repeater-field")).find(".astra-field-image-preview").html(""),t.find(".astra-field-image-preview img").attr("src",""),t.find(".astra-field-image-preview-id").val(""),t.find(".astra-image-url").val(""),t.find(".astra-image-alt").val(""),t.find(".astra-image-title").val(""),t.find(".astra-image-size-select, .astra-image-width").hide(),t.find(".astra-select-image.button").css("display","inline-block"))},_repeater_add_image_field:function(e){var a=l(this).parents(".astra-repeater-field"),s=wp.media({title:"Select or Upload Image",button:{text:"Choose Image"},library:{type:"image"},multiple:!1});return s.on("close",function(){var e,t=s.state().get("selection").toJSON();l.isEmptyObject(t)||(e=(t[0].sizes.hasOwnProperty("medium")?t[0].sizes.medium:t[0].sizes.hasOwnProperty("thumbnail")?t[0].sizes.thumbnail:t[0].sizes.full).url,0<a.find(".astra-remove-image").length?a.find(".astra-field-image-preview img").attr("src",e):a.find(".astra-field-image-preview").append('<img src="'+e+'" /><span class="astra-remove-image button">Remove</span>'),a.find(".astra-image-url").val(t[0].url),a.find(".astra-image-alt").val(t[0].alt),a.find(".astra-image-title").val(t[0].title),a.find(".astra-field-image-preview-id").val(t[0].id),a.find(".astra-select-image.button").css("display","none"),a.find(".astra-image-size-select, .astra-image-width").show(),a.find("input").trigger("change"))}),s.open(),!1},_get_sub_string:function(e){var t="";return 24<e.length&&(t=".."),e=e.substring(0,24)+t},_repeater_set_title:function(e){var t=l(this).val()||"",t=AstraWidgets._get_sub_string(t);l(this).closest(".astra-repeater-field").find(".title").text(t)},_repeater_reinit:function(e){l(".astra-repeater-sortable").sortable()},_add_new:function(e){e.preventDefault();var t=l(this).closest(".astra-repeater"),a=l(".astra-repeater-field").length||0,s=t.find(".astra-repeater-fields").html(),i=t.find(".astra-repeater-fields").attr("title")||"",e=(t.find(".astra-repeater-fields").attr("data-id"),'<div class="astra-repeater-field">');e+='\t<div class="actions">',e+='\t<span class="index">'+a+"</span>",e+='\t\t<span class="dashicons dashicons-move"></span>',e+='\t<span class="title">'+i+"</span>",e+='\t\t<span class="dashicons dashicons-admin-page clone"></span>',e+='\t\t<span class="dashicons dashicons-trash remove"></span>',e+='\t\t<span class="dashicons toggle-arrow"></span>',e+="\t</div>",e+='\t<div class="markukp">',e+=s=s.replace("][][","]["+a+"]["),e+="\t</div>",e+="</div>",t.find(".astra-repeater-sortable").append(e),AstraWidgets._set_repeater_names()},_set_repeater_names:function(){l(".astra-repeater").each(function(e,t){var r=l(t).find(".astra-repeater-fields").attr("data-id")||"";l(t).find(".astra-repeater-sortable").find(".astra-repeater-field").each(function(s,i){l(i).find(":input").each(function(e,t){var a=l(t).attr("data-field-id")||"",a=r+"["+s+"]["+a+"]";l(i).find(".index").text(s),l(t).attr("name",a)})})})},_repeater_toggle_open:function(e){e.preventDefault(),(e.target===this||l(e.target).hasClass("title")||l(e.target).hasClass("dashicons-move"))&&(l(this).parents(".astra-repeater-field").toggleClass("field-open"),l(this).parents(".astra-repeater-field").find(".markukp").slideToggle())},_repeater_clone:function(e){e.preventDefault();var t=l(this),e=t.closest(".astra-repeater");e.find(".astra-repeater-fields").html();l(t).closest(".astra-repeater-field").clone().insertAfter(t.closest(".astra-repeater-field")),l(".astra-repeater-sortable").sortable(),e.find("input").trigger("change"),AstraWidgets._set_repeater_names()},_repeater_remove:function(e){e.preventDefault();var t=l(this),a=t.closest(".astra-repeater"),s=t.parent().find(".title").html(),e="",e=0<s.length?s:"this field";confirm("Are you sure you want to delete "+e+"?")&&t.closest(".astra-repeater-field").remove(),AstraWidgets._set_repeater_names(),a.find("input").trigger("change")},_init_repeater:function(){l(".astra-repeater-sortable").sortable({cursor:"move",stop:function(e,t){AstraWidgets._set_repeater_names(),t.item.find("input").trigger("change")}}),AstraWidgets._set_repeater_names(),l(".astra-repeater-field").length&&l(".astra-repeater-field").each(function(e,t){var a=l(t).find('[data-field-id="title"]').val()||"",s=l(t).find('[data-field-id="icon"]').val()||"",a=AstraWidgets._get_sub_string(a);l(t).find(".title").text(a),"yes"===l(t).find(".selected-icon").data("icon-visible")&&l(t).find(".title").addClass(s)})}},l(function(){AstraWidgets.init()})}(jQuery);