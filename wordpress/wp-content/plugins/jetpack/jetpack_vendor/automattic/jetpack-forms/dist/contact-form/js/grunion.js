window.FB||(window.FB={}),GrunionFB_i18n=jQuery.extend({nameLabel:"Name",emailLabel:"Email",urlLabel:"Website",commentLabel:"Comment",newLabel:"New Field",optionsLabel:"Options",optionLabel:"Option",firstOptionLabel:"First option",problemGeneratingForm:"Oops, there was a problem generating your form.  You'll likely need to try again.",moveInstructions:"Drag up or down\nto re-arrange",moveLabel:"move",editLabel:"edit",savedMessage:"Saved successfully",requiredLabel:"(required)",exitConfirmMessage:"Are you sure you want to exit the form editor without saving?  Any changes you have made will be lost.",maxNewFields:5,invalidEmail:" is an invalid email address."},GrunionFB_i18n),GrunionFB_i18n.moveInstructions=GrunionFB_i18n.moveInstructions.replace("\n","<br />"),FB.span=jQuery("<span>"),FB.esc_html=function(e){return FB.span.text(e).html()},FB.esc_attr=function(e){return(e=FB.esc_html(e)).replace('"',"&quot;").replace("'","&#039;")},FB.ContactForm=function(){const e={action:"grunion_shortcode",_ajax_nonce:ajax_nonce_shortcode,to:"",subject:"",fields:{}},i={name:{label:GrunionFB_i18n.nameLabel,type:"name",required:!0,options:[],order:"1"},email:{label:GrunionFB_i18n.emailLabel,type:"email",required:!0,options:[],order:"2"},url:{label:GrunionFB_i18n.urlLabel,type:"url",required:!1,options:[],order:"3"},comment:{label:GrunionFB_i18n.commentLabel,type:"textarea",required:!0,options:[],order:"4"}},n=!1;let o=0;const t=GrunionFB_i18n.maxNewFields;let l,r={},a=0;function d(e,i){try{let n="";for(let o=0;o<r[e].options.length;o++)void 0!==r[e].options[o]&&(n="radio"===i?n+'<div id="fb-radio-'+e+"-"+o+'"><input type="radio" id="fb-field'+e+'" name="radio-'+e+'" /><span>'+FB.esc_html(r[e].options[o])+'</span><div class="clear"></div></div>':"checkbox-multiple"===i?n+'<div id="fb-checkbox-multiple-'+e+"-"+o+'"><input type="checkbox" id="fb-field'+e+'" name="checkbox-multiple-'+e+'" /><span>'+FB.esc_html(r[e].options[o])+'</span><div class="clear"></div></div>':n+'<option id="fb-'+e+"-"+o+'" value="'+e+"-"+o+'">'+FB.esc_html(r[e].options[o])+"</option>");return n}catch(e){n&&console.log("customOptions(): "+e)}}function s(i){try{scroll(0,0),setTimeout((function(){jQuery("#fb-new-label").focus().select()}),100),function(i){try{const n=e.fields[i].type;if(jQuery("#fb-options").hide(),jQuery("#fb-field-id").val(i),jQuery("#fb-new-label").val(e.fields[i].label),jQuery("#fb-new-type").val(e.fields[i].type),e.fields[i].required?jQuery("#fb-new-required").prop("checked",!0):jQuery("#fb-new-required").prop("checked",!1),"select"===n||"radio"===n||"checkbox-multiple"===n){const n=e.fields[i].options;jQuery("#fb-options").show(),jQuery("#fb-new-options").html("");for(let o=0;o<n.length;o++)void 0!==n[o]&&jQuery("#fb-new-options").append('<div id="fb-option-box-'+o+'" class="fb-new-fields"><span optionid="'+o+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+o+'" optionid="'+o+'" value="'+FB.esc_attr(e.fields[i].options[o])+'" class="fb-options" /><div>')}u()}catch(e){n&&console.log("loadFieldEditor(): "+e)}}(i.parent().attr("fieldid"))}catch(e){n&&console.log("editField(): "+e)}}function u(){jQuery("#fb-desc").hide(),jQuery("#fb-add-field").show()}function f(){try{return jQuery("#TB_imageOff",window.parent.document).unbind("click"),jQuery("#TB_closeWindowButton",window.parent.document).unbind("click"),jQuery("#TB_window",window.parent.document).fadeOut("fast"),jQuery("body",window.parent.document).removeClass("modal-open"),jQuery("#TB_window,#TB_overlay,#TB_HideSelect",window.parent.document).trigger("unload").unbind().remove(),jQuery("#TB_load",window.parent.document).remove(),void 0===window.parent.document.body.style.maxHeight&&(jQuery("body","html",window.parent.document).css({height:"auto",width:"auto"}),jQuery("html",window.parent.document).css("overflow","")),window.parent.document.onkeydown="",window.parent.document.onkeyup="",!1}catch(e){n&&console.log("hidePopup(): "+e)}}function c(e,i){try{"show"===e?(jQuery(".fb-edit-field").is(":visible")&&jQuery(".fb-edit-field").remove(),i.find("label").prepend('<span class="right fb-edit-field" style="font-weight: normal;"><a href="" class="fb-reorder"><div style="display: none;">'+GrunionFB_i18n.moveInstructions+"</div>"+GrunionFB_i18n.moveLabel+'</a>&nbsp;&nbsp;<span style="color: #C7D8DE;">|</span>&nbsp;&nbsp;<a href="" class="fb-edit">'+GrunionFB_i18n.editLabel+"</a></span>")):jQuery(".fb-edit-field").remove()}catch(e){n&&console.log("hideShowEditLink(): "+e)}}function b(){try{const i=jQuery("#fb-field-id").val();jQuery("#fb-options").hide(),void 0===r[i]&&(r[i]={}),r[i].options=e.fields[i].options,e.fields[i].options=[]}catch(e){n&&console.log("removeOptions(): "+e)}}function p(){jQuery("#fb-desc").show(),jQuery("#fb-add-field").hide()}function y(e){try{const i=e||GrunionFB_i18n.savedMessage;jQuery("#fb-success").text(i),jQuery("#fb-success").slideDown("fast"),setTimeout((function(){jQuery("#fb-success").slideUp("fast")}),2500)}catch(e){n&&console.log("showAndHideMessage(): "+e)}}function m(e){try{if("preview"===e){if(!function(e){if(0===e.length)return!0;let i,n=e.split(",");for(i=0;i<n.length;i++)if(!1===w(n[i]))return alert(n[i]+GrunionFB_i18n.invalidEmail),!1;return!0}(jQuery("#fb-field-my-email").val()))return;jQuery("#tab-preview a").addClass("current"),jQuery("#tab-settings a").removeClass("current"),jQuery("#fb-preview-form, #fb-desc").show(),jQuery("#fb-email-settings, #fb-email-desc").hide(),y(GrunionFB_i18n.savedMessage)}else jQuery("#tab-preview a").removeClass("current"),jQuery("#tab-settings a").addClass("current"),jQuery("#fb-preview-form, #fb-desc, #fb-add-field").hide(),jQuery("#fb-email-settings, #fb-email-desc").show(),jQuery("#fb-field-my-email").focus().select()}catch(e){n&&console.log("switchTabs(): "+e)}}function w(e){return/^(?=[a-z0-9@.!#$%&'*+/=?^_`{|}~-]{6,254}$)(?=[a-z0-9.!#$%&'*+/=?^_`{|}~-]{1,64}@)[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:(?=[a-z0-9-]{1,63}\.)[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+(?=[a-z0-9-]{1,63}$)[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(e)}function v(i,o,t){try{const n=jQuery("#fb-field-id").val();i||(i=jQuery("#fb-new-type").val()),o||(o=jQuery("#fb-new-field"+n+" .label-text").text());const l=t?'<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>":"",s='<label fieldid="'+n+'" for="fb-field'+n+'"><span class="label-text">'+FB.esc_html(o)+"</span>"+l+"</label>",u='<input type="radio" name="radio-'+n+'" id="fb-field'+n+' "disabled="disabled" />',f='<label fieldid="'+n+'" for="fb-field'+n+'" class="fb-radio-label"><span class="label-text">'+FB.esc_html(o)+"</span>"+l+"</label>",c='<div class="fb-remove fb-remove-small" id="'+n+'"></div>',p='<div class="fb-remove" id="'+n+'"></div>',y='<input type="checkbox" id="fb-field'+n+'" "disabled="disabled" />',m='<input type="checkbox" id="fb-field'+n+'" "disabled="disabled" />',w='<div class="fb-remove fb-remove-small" id="'+n+'"></div>',v='<input type="text" id="fb-field'+n+'" "disabled="disabled" />',j='<textarea id="fb-field'+n+'" "disabled="disabled"></textarea>',Q='<div class="clear"></div>',h='<select id="fb-field'+n+'" fieldid="'+n+'"><option id="fb-'+n+"-"+a+'" value="'+n+"-"+a+'">'+GrunionFB_i18n.firstOptionLabel+"</option></select>";switch(i){case"checkbox":b(),jQuery("#fb-new-field"+n+" .fb-fields").html(c+y+f+Q);break;case"checkbox-multiple":jQuery("#fb-new-field"+n+" .fb-fields").html(s+w+'<div fieldid="'+n+'" id="fb-custom-checkbox-multiple'+n+'"></div>'),void 0!==r[n]&&0!==r[n].options.length?(e.fields[n].options=r[n].options,jQuery("#fb-custom-checkbox-multiple"+n).append(d(n,i))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-custom-checkbox-multiple"+n).append('<div id="fb-checkbox-multiple-'+n+'-0">'+m+"<span>"+GrunionFB_i18n.firstOptionLabel+"</span>"+Q+"</div>"),e.fields[n].options[a]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout((function(){jQuery("#fb-option0").focus().select()}),100);break;case"email":case"name":case"text":case"url":b(),jQuery("#fb-new-field"+n+" .fb-fields").html(p+s+v);break;case"radio":jQuery("#fb-new-field"+n+" .fb-fields").html(s+c+'<div fieldid="'+n+'" id="fb-custom-radio'+n+'"></div>'),void 0!==r[n]&&0!==r[n].options.length?(e.fields[n].options=r[n].options,jQuery("#fb-custom-radio"+n).append(d(n,i))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-custom-radio"+n).append('<div id="fb-radio-'+n+'-0">'+u+"<span>"+GrunionFB_i18n.firstOptionLabel+"</span>"+Q+"</div>"),e.fields[n].options[a]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout((function(){jQuery("#fb-option0").focus().select()}),100);break;case"select":jQuery("#fb-new-field"+n+" .fb-fields").html(p+s+h),void 0!==r[n]&&0!==r[n].options.length?(e.fields[n].options=r[n].options,jQuery("#fb-field"+n).html(d(n,i))):(jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),e.fields[n].options[a]=GrunionFB_i18n.firstOptionLabel),jQuery("#fb-options").show(),setTimeout((function(){jQuery("#fb-option0").focus().select()}),100);break;case"textarea":b(),jQuery("#fb-new-field"+n+" .fb-fields").html(p+s+j)}e.fields[n].type=i}catch(e){n&&console.log("updateType(): "+e)}}return{resizePop:function(){try{const e=jQuery("body",window.parent.document).width(),i=jQuery("body",window.parent.document).height(),n=void 0===document.body.style.maxHeight;jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("width","768px"),jQuery("#TB_window",window.parent.document).css({left:(e-768)/2+"px",top:"23px",position:"absolute",marginLeft:"0"}),n||jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("height",i-73+"px")}catch(e){n&&console.log("resizePop(): "+e)}},init:function(){let d;window.parent.scroll(0,0),d=jQuery("#edButtonPreview",window.parent.document).hasClass("active")||jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active")?(window.dialogArguments||opener||parent||top).tinyMCE.activeEditor.getContent():jQuery("#content",window.parent.document).val();const b={action:"grunion_shortcode_to_json",_ajax_nonce:ajax_nonce_json,post_id:postId,content:d},w=jQuery(document);jQuery.post(ajaxurl,b,(function(o){!function(o){try{e.fields={},o?(jQuery.each(o.fields,(function(i,n){1===parseInt(n.required,10)&&(n.required="true"),e.fields[i]=n})),e.to=o.to,e.subject=o.subject):e.fields=i}catch(e){n&&console.log("parseShortcode(): "+e)}}(jQuery.parseJSON(o)),function(){try{e.to&&jQuery("#fb-field-my-email").val(e.to),e.subject&&jQuery("#fb-field-subject").val(e.subject),jQuery.each(e.fields,(function(e,i){jQuery("#fb-extra-fields").before('<div class="fb-new-fields ui-state-default" fieldid="'+e+'" id="fb-new-field'+e+'"><div class="fb-fields"></div></div>'),jQuery("#fb-field-id").val(e),r[e]={},r[e].options=[],"radio"!==i.type&&"select"!==i.type&&"checkbox-multiple"!==i.type||jQuery.each(i.options,(function(i,n){r[e].options[i]=n})),v(i.type,i.label,i.required)}))}catch(e){n&&console.log("buildPreview(): "+e)}}()})),jQuery(".fb-add-field").click((function(){return function(){try{o++,o<=t?(jQuery("#fb-extra-fields").append('<div id="fb-new-field'+o+'" fieldid="'+o+'" class="fb-new-fields"><div class="fb-fields"><div id="'+o+'" class="fb-remove"></div><label fieldid="'+o+'" for="fb-field'+o+'"><span class="label-text">'+GrunionFB_i18n.newLabel+'</span> </label><input type="text" id="fb-field'+o+'" disabled="disabled" /></div></div>'),e.fields[o]={label:GrunionFB_i18n.newLabel,type:"text",required:!1,options:[],order:"5"},o===t&&jQuery("#fb-new-field").hide(),a=0,r={},jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />'),jQuery("#fb-options").hide(),jQuery("#fb-new-label").val(GrunionFB_i18n.newLabel),jQuery("#fb-new-type").val("text"),jQuery("#fb-field-id").val(o),setTimeout((function(){jQuery("#fb-new-label").focus().select()}),100)):jQuery("#fb-new-field").hide()}catch(e){n&&console.log("addField(): "+e)}}(),u(),!1})),jQuery("#fb-new-label").keyup((function(){!function(){try{const i=jQuery("#fb-field-id").val(),n=jQuery("#fb-new-label").val();0===n.length?jQuery("#fb-new-field"+i+" label .label-text").text(GrunionFB_i18n.newLabel):jQuery("#fb-new-field"+i+" label .label-text").text(n),e.fields[i].label=n}catch(e){n&&console.log("updateLabel(): "+e)}}()})),jQuery("#fb-new-type").change((function(){v()})),jQuery("#fb-new-required").click((function(){!function(){try{const i=jQuery("#fb-field-id").val();jQuery("#fb-new-required").is(":checked")?(e.fields[i].required=!0,jQuery("#fb-new-field"+i+" label").append('<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>")):(e.fields[i].required=!1,jQuery("#fb-new-field"+i+" label .label-required").remove())}catch(e){n&&console.log("updateRequired(): "+e)}}()})),w.on("click",".fb-remove",(function(){p(),function(i){try{o--;const n=i.attr("id");delete e.fields[n],jQuery("#"+n).parent().parent().remove(),o<=t&&jQuery("#fb-new-field").show()}catch(e){n&&console.log("deleteField(): "+e)}}(jQuery(this)),function(){try{jQuery.post(ajaxurl,e,(function(e){l=e}))}catch(e){alert(GrunionFB_i18n.problemGeneratingForm),n&&console.log("grabShortcode(): "+e)}}()})),jQuery("#fb-preview").submit((function(){return function(){try{jQuery("div#sortable div.fb-new-fields").each((function(i){const n=jQuery(this).attr("fieldid");e.fields[n].order=i})),jQuery.post(ajaxurl,e,(function(e){let i=jQuery("#edButtonPreview",window.parent.document).hasClass("active");i||(i=jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active"));const n=window.dialogArguments||opener||parent||top;let o;i?o=n.tinyMCE.activeEditor.getContent():(o=jQuery("#editorcontainer textarea",window.parent.document).val(),"string"!=typeof o&&(o=jQuery(".wp-editor-area",window.parent.document).val()));const t=new RegExp("\\[contact-form\\b.*?\\/?\\](?:[\\s\\S]+?\\[\\/contact-form\\])?");if(e=(e=e.replace(/\n/g," ")).replace(/%26#x002c;/g,","),o.match(t))i?n.tinyMCE.activeEditor.execCommand("mceSetContent",!1,o.replace(t,e)):jQuery("#content",window.parent.document).val(o.replace(t,e));else try{n.send_to_editor(e)}catch(t){i?n.tinyMCE.activeEditor.execCommand("mceInsertContent",!1,e):jQuery("#content",window.parent.document).val(o+e)}f()}))}catch(e){n&&console.log("sendShortcodeToEditor(): "+e)}}(),!1})),jQuery("#TB_overlay, #TB_closeWindowButton",window.parent.document).mousedown((function(){confirm(GrunionFB_i18n.exitConfirmMessage)&&f()})),w.on("click","#fb-another-option",(function(){!function(){try{a=jQuery("#fb-new-options .fb-options").length;const i=jQuery("#fb-field-id").val(),n=jQuery("#fb-new-type").val();"radio"===n?(jQuery("#fb-new-options").append('<div id="fb-option-box-'+a+'" class="fb-new-fields"><span optionid="'+a+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+a+'" optionid="'+a+'" value="'+GrunionFB_i18n.optionLabel+'" class="fb-options" /><div>'),jQuery("#fb-new-field"+i+" .fb-fields").append('<div id="fb-radio-'+i+"-"+a+'"><input type="radio" disabled="disabled" id="fb-field'+i+'" name="radio-'+i+'" /><span>'+GrunionFB_i18n.optionLabel+'</span><div class="clear"></div></div>')):"checkbox-multiple"===n?(jQuery("#fb-new-options").append('<div id="fb-option-box-'+a+'" class="fb-new-fields"><span optionid="'+a+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+a+'" optionid="'+a+'" value="'+GrunionFB_i18n.optionLabel+'" class="fb-options" /><div>'),jQuery("#fb-new-field"+i+" .fb-fields").append('<div id="fb-checkbox-multiple-'+i+"-"+a+'"><input type="checkbox" disabled="disabled" id="fb-field'+i+'" name="checkbox-multiple-'+i+'" /><span>'+GrunionFB_i18n.optionLabel+'</span><div class="clear"></div></div>')):(jQuery("#fb-new-options").append('<div id="fb-option-box-'+a+'" class="fb-new-fields"><span optionid="'+a+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+a+'" optionid="'+a+'" value="" class="fb-options" /><div>'),jQuery("#fb-field"+i).append('<option id="fb-'+i+"-"+a+'" value="'+i+"-"+a+'"></option>')),e.fields[i].options[a]="",jQuery("#fb-option"+a).focus().select()}catch(e){n&&console.log("addOption(): "+e)}}()})),w.on("keyup",".fb-options",(function(){!function(i){try{const n=jQuery("#fb-field-id").val(),o=i.attr("optionid"),t=i.val(),l=jQuery("#fb-new-type").val();"radio"===l?jQuery("#fb-radio-"+n+"-"+o+" span").text(t):"checkbox-multiple"===l?jQuery("#fb-checkbox-multiple-"+n+"-"+o+" span").text(t):jQuery("#fb-"+n+"-"+o).text(t),e.fields[n].options[o]=t}catch(e){n&&console.log("updateOption(): "+e)}}(jQuery(this))})),w.on("click",".fb-remove-option",(function(){!function(i){try{const n=jQuery("#fb-field-id").val(),o=jQuery("#fb-option"+i).val(),t=jQuery("#fb-new-type").val();jQuery("#fb-option-box-"+i).remove(),"radio"===t?jQuery("#fb-radio-"+n+"-"+i).remove():"checkbox-multiple"===t?jQuery("#fb-checkbox-multiple-"+n+"-"+i).remove():jQuery("#fb-"+n+"-"+i).remove();const l=e.fields[n].options.indexOf(o);-1!==l&&e.fields[n].options.splice(l,1)}catch(e){n&&console.log("removeOption(): "+e)}}(jQuery(this).attr("optionid"))})),jQuery("#tab-preview a").click((function(){return m("preview"),!1})),jQuery("#fb-prev-form").click((function(){return m("preview"),!1})),jQuery("#tab-settings a").click((function(){return m(),!1})),jQuery("#fb-field-my-email").blur((function(){!function(){try{const i=jQuery("#fb-field-my-email").val();e.to=i}catch(e){n&&console.log("updateMyEmail(): "+e)}}()})),jQuery("#fb-field-subject").blur((function(){!function(){try{const i=jQuery("#fb-field-subject").val();e.subject=i}catch(e){n&&console.log("updateSubject(): "+e)}}()})),w.on("mouseenter",".fb-form-case .fb-new-fields",(function(){c("show",jQuery(this))})),w.on("mouseleave",".fb-form-case .fb-new-fields",(function(){return c("hide"),!1})),w.on("click",".fb-edit-field",(function(){return s(jQuery(this)),!1})),w.on("click",".fb-edit-field .fb-reorder",(function(){return!1})),w.on("click","#fb-save-field",(function(){return p(),y(),!1})),jQuery("#fb-feedback").click((function(){const e=jQuery(this).attr("href");return window.parent.location=e,!1})),jQuery("#sortable").sortable({axis:"y",handle:".fb-reorder",revert:!0,start:function(){jQuery(".fb-edit-field").hide()}}),jQuery("#draggable").draggable({axis:"y",handle:".fb-reorder",connectToSortable:"#sortable",helper:"clone",revert:"invalid"})}}}();