if(typeof PhpDebugBar>"u"){var PhpDebugBar={};PhpDebugBar.$=jQuery}(function(a){typeof localStorage>"u"&&(localStorage={setItem:function(t,e){},getItem:function(t){return null}}),typeof PhpDebugBar.utils>"u"&&(PhpDebugBar.utils={});var g=PhpDebugBar.utils.getDictValue=function(t,e,i){for(var s=t,r=e.split("."),o=0;o<r.length;o++){if(!s[r[o]])return i;s=s[r[o]]}return s},c=PhpDebugBar.utils.getObjectSize=function(t){if(Object.keys)return Object.keys(t).length;var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;return e};PhpDebugBar.utils.csscls=function(t,e){if(t.indexOf(" ")>-1){for(var i=t.split(" "),s=[],r=0,o=i.length;r<o;r++)s.push(PhpDebugBar.utils.csscls(i[r],e));return s.join(" ")}return t.indexOf(".")===0?"."+e+t.substr(1):e+t},PhpDebugBar.utils.makecsscls=function(t){var e=function(i){return PhpDebugBar.utils.csscls(i,t)};return e};var n=PhpDebugBar.utils.makecsscls("phpdebugbar-"),l=PhpDebugBar.Widget=function(t){this._attributes=a.extend({},this.defaults),this._boundAttributes={},this.$el=a("<"+this.tagName+" />"),this.className&&this.$el.addClass(this.className),this.initialize.apply(this,[t||{}]),this.render.apply(this)};a.extend(l.prototype,{tagName:"div",className:null,defaults:{},initialize:function(t){this.set(t)},render:function(){},set:function(t,e){if(typeof t!="string"){for(var i in t)this.set(i,t[i]);return}if(this._attributes[t]=e,typeof this._boundAttributes[t]<"u")for(var s=0,r=this._boundAttributes[t].length;s<r;s++)this._boundAttributes[t][s].apply(this,[e])},has:function(t){return typeof this._attributes[t]<"u"&&this._attributes[t]!==null},get:function(t){return this._attributes[t]},bindAttr:function(t,e){if(Array.isArray(t)){for(var i=0,s=t.length;i<s;i++)this.bindAttr(t[i],e);return}if(typeof this._boundAttributes[t]>"u"&&(this._boundAttributes[t]=[]),typeof e=="object"){var r=e;e=function(o){r.text(o||"")}}this._boundAttributes[t].push(e),this.has(t)&&e.apply(this,[this._attributes[t]])}}),l.extend=function(t){var e=this,i=function(){return e.apply(this,arguments)};a.extend(i,e);var s=function(){this.constructor=i};return s.prototype=e.prototype,i.prototype=new s,a.extend(i.prototype,t),i.__super__=e.prototype,i};var u=l.extend({className:n("panel"),render:function(){this.$tab=a("<a />").addClass(n("tab")),this.$icon=a("<i />").appendTo(this.$tab),this.bindAttr("icon",function(t){t?this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+t):this.$icon.attr("class","")}),this.bindAttr("title",a("<span />").addClass(n("text")).appendTo(this.$tab)),this.$badge=a("<span />").addClass(n("badge")).appendTo(this.$tab),this.bindAttr("badge",function(t){t!==null?(this.$badge.text(t),this.$badge.addClass(n("visible"))):this.$badge.removeClass(n("visible"))}),this.bindAttr("widget",function(t){this.$el.empty().append(t.$el)}),this.bindAttr("data",function(t){this.has("widget")&&this.get("widget").set("data",t)})}}),f=l.extend({tagName:"span",className:n("indicator"),render:function(){this.$icon=a("<i />").appendTo(this.$el),this.bindAttr("icon",function(t){t?this.$icon.attr("class","phpdebugbar-fa phpdebugbar-fa-"+t):this.$icon.attr("class","")}),this.bindAttr(["title","data"],a("<span />").addClass(n("text")).appendTo(this.$el)),this.$tooltip=a("<span />").addClass(n("tooltip disabled")).appendTo(this.$el),this.bindAttr("tooltip",function(t){t?this.$tooltip.text(t).removeClass(n("disabled")):this.$tooltip.addClass(n("disabled"))})}}),p=PhpDebugBar.DatasetTitleFormater=function(t){this.debugbar=t};a.extend(p.prototype,{format:function(t,e,i){i?i=" "+i:i="";var s=c(this.debugbar.datasets)+1;if(typeof e.__meta>"u")return"#"+s+i;var r=e.__meta.uri.split("/"),o=r.pop();o||(o=(r.pop()||"")+"/"),r.length&&!isNaN(o)&&(o=r.pop()+"/"+o);var d=150;o.length>d&&(o=o.substr(0,d)+"...");var h="#"+s+" "+o+i+" ("+e.__meta.datetime.split(" ")[1]+")";return h}});var b=PhpDebugBar.DebugBar=l.extend({className:"phpdebugbar "+n("minimized"),options:{bodyMarginBottom:!0,bodyMarginBottomHeight:0},initialize:function(){this.controls={},this.dataMap={},this.datasets={},this.firstTabName=null,this.activePanelName=null,this.datesetTitleFormater=new p(this),this.options.bodyMarginBottomHeight=parseInt(a("body").css("margin-bottom")),this.hasParent=window.parent&&window.parent!==window.top&&window.parent.phpdebugbar&&window.parent.phpdebugbar!=this,this.registerResizeHandler()},registerResizeHandler:function(){if(!(typeof this.resize.bind>"u"||this.hasParent)){var t=this.resize.bind(this);this.respCSSSize=0,a(window).resize(t),setTimeout(t,20)}},resize:function(){var t=this.respCSSSize;this.respCSSSize==0&&this.$header.find("> div > *:visible").each(function(){t+=a(this).outerWidth()});var e=this.$header.width(),i="phpdebugbar-mini-design",s=this.$header.hasClass(i);e<=t&&!s?(this.respCSSSize=t,this.$header.addClass(i)):t<e&&s&&(this.respCSSSize=0,this.$header.removeClass(i)),this.setHeight(this.$body.height())},render:function(){this.hasParent&&this.$el.hide();var t=this;this.$el.appendTo("body"),this.$dragCapture=a("<div />").addClass(n("drag-capture")).appendTo(this.$el),this.$resizehdle=a("<div />").addClass(n("resize-handle")).appendTo(this.$el),this.$header=a("<div />").addClass(n("header")).appendTo(this.$el),this.$headerBtn=a("<a />").addClass(n("restore-btn")).appendTo(this.$header),this.$headerBtn.click(function(){t.close()}),this.$headerLeft=a("<div />").addClass(n("header-left")).appendTo(this.$header),this.$headerRight=a("<div />").addClass(n("header-right")).appendTo(this.$header);var e=this.$body=a("<div />").addClass(n("body")).appendTo(this.$el);this.recomputeBottomOffset();var i,s;this.$resizehdle.on("mousedown",function(d){s=e.height(),i=d.pageY,e.parents().on("mousemove",r).on("mouseup",o),t.$dragCapture.show(),d.preventDefault()});var r=function(d){var h=s+(i-d.pageY);t.setHeight(h)},o=function(){e.parents().off("mousemove",r).off("mouseup",o),t.$dragCapture.hide()};this.$closebtn=a("<a />").addClass(n("close-btn")).appendTo(this.$headerRight),this.$closebtn.click(function(){t.close()}),this.$minimizebtn=a("<a />").addClass(n("minimize-btn")).appendTo(this.$headerRight),this.$minimizebtn.click(function(){t.minimize()}),this.$maximizebtn=a("<a />").addClass(n("maximize-btn")).appendTo(this.$headerRight),this.$maximizebtn.click(function(){t.restore()}),this.$restorebtn=a("<a />").addClass(n("restore-btn")).hide().appendTo(this.$el),this.$restorebtn.click(function(){t.restore()}),this.$openbtn=a("<a />").addClass(n("open-btn")).appendTo(this.$headerRight).hide(),this.$openbtn.click(function(){t.openHandler.show(function(d,h){t.addDataSet(h,d,"(opened)"),t.showTab()})}),this.$datasets=a("<select />").addClass(n("datasets-switcher")).attr("name","datasets-switcher").appendTo(this.$headerRight),this.$datasets.change(function(){t.dataChangeHandler(t.datasets[this.value]),t.showTab()})},setHeight:function(t){var e=40,i=a(window).innerHeight()-this.$header.height()-10;t=Math.min(t,i),t=Math.max(t,e),this.$body.css("height",t),localStorage.setItem("phpdebugbar-height",t),this.recomputeBottomOffset()},restoreState:function(){if(!this.hasParent){var t=localStorage.getItem("phpdebugbar-height");this.setHeight(t||this.$body.height());var e=localStorage.getItem("phpdebugbar-open");if(e&&e=="0")this.close();else{var i=localStorage.getItem("phpdebugbar-visible");if(i&&i=="1"){var s=localStorage.getItem("phpdebugbar-tab");this.isTab(s)&&this.showTab(s)}}}},createTab:function(t,e,i){var s=new u({title:i||t.replace(/[_\-]/g," ").charAt(0).toUpperCase()+t.slice(1),widget:e});return this.addTab(t,s)},addTab:function(t,e){if(this.isControl(t))throw new Error(t+" already exists");var i=this;return e.$tab.appendTo(this.$headerLeft).click(function(){!i.isMinimized()&&i.activePanelName==t?i.minimize():i.showTab(t)}),e.$el.appendTo(this.$body),this.controls[t]=e,this.firstTabName==null&&(this.firstTabName=t),e},createIndicator:function(t,e,i,s){var r=new f({icon:e,tooltip:i});return this.addIndicator(t,r,s)},addIndicator:function(t,e,i){if(this.isControl(t))throw new Error(t+" already exists");return i=="left"?e.$el.insertBefore(this.$headerLeft.children().first()):e.$el.appendTo(this.$headerRight),this.controls[t]=e,e},getControl:function(t){if(this.isControl(t))return this.controls[t]},isControl:function(t){return typeof this.controls[t]<"u"},isTab:function(t){return this.isControl(t)&&this.controls[t]instanceof u},isIndicator:function(t){return this.isControl(t)&&this.controls[t]instanceof f},reset:function(){this.minimize();var t=this;a.each(this.controls,function(e,i){t.isTab(e)&&i.$tab.remove(),i.$el.remove()}),this.controls={}},showTab:function(t){if(t||(this.activePanelName?t=this.activePanelName:t=this.firstTabName),!this.isTab(t))throw new Error("Unknown tab '"+t+"'");this.$resizehdle.show(),this.$body.show(),this.recomputeBottomOffset(),a(this.$header).find("> div > ."+n("active")).removeClass(n("active")),a(this.$body).find("> ."+n("active")).removeClass(n("active")),this.controls[t].$tab.addClass(n("active")),this.controls[t].$el.addClass(n("active")),this.activePanelName=t,this.$el.removeClass(n("minimized")),localStorage.setItem("phpdebugbar-visible","1"),localStorage.setItem("phpdebugbar-tab",t),this.resize()},minimize:function(){this.$header.find("> div > ."+n("active")).removeClass(n("active")),this.$body.hide(),this.$resizehdle.hide(),this.recomputeBottomOffset(),localStorage.setItem("phpdebugbar-visible","0"),this.$el.addClass(n("minimized")),this.resize()},isMinimized:function(){return this.$el.hasClass(n("minimized"))},close:function(){this.$resizehdle.hide(),this.$header.hide(),this.$body.hide(),this.$restorebtn.show(),localStorage.setItem("phpdebugbar-open","0"),this.$el.addClass(n("closed")),this.recomputeBottomOffset()},isClosed:function(){return this.$el.hasClass(n("closed"))},restore:function(){this.$resizehdle.show(),this.$header.show(),this.$restorebtn.hide(),localStorage.setItem("phpdebugbar-open","1");var t=localStorage.getItem("phpdebugbar-tab");this.isTab(t)?this.showTab(t):this.showTab(),this.$el.removeClass(n("closed")),this.resize()},recomputeBottomOffset:function(){if(this.options.bodyMarginBottom){if(this.isClosed())return a("body").css("margin-bottom",this.options.bodyMarginBottomHeight||"");var t=parseInt(this.$el.height())+(this.options.bodyMarginBottomHeight||0);a("body").css("margin-bottom",t)}},setDataMap:function(t){this.dataMap=t},addDataMap:function(t){a.extend(this.dataMap,t)},setData:function(t){return this.datasets={},this.addDataSet(t)},addDataSet:function(t,e,i,s){if(this.hasParent){(!i||"(iframe)".indexOf(i)<0)&&(i="(iframe)"+(i||"")),window.parent.phpdebugbar.addDataSet(t,e,i,s);return}var r=this.datesetTitleFormater.format(e,t,i);return e=e||c(this.datasets)+1,this.datasets[e]=t,this.$datasets.append(a('<option value="'+e+'">'+r+"</option>")),this.$datasets.children().length>1&&this.$datasets.show(),(typeof s>"u"||s)&&this.showDataSet(e),e},loadDataSet:function(t,e,i,s){if(!this.openHandler)throw new Error("loadDataSet() needs an open handler");var r=this;this.openHandler.load(t,function(o){r.addDataSet(o,t,e,s),r.resize(),i&&i(o)})},getDataSet:function(t){return this.datasets[t]},showDataSet:function(t){this.dataChangeHandler(this.datasets[t]),this.$datasets.val(t)},dataChangeHandler:function(t){var e=this;a.each(this.dataMap,function(i,s){var r=g(t,s[0],s[1]);i.indexOf(":")!=-1?(i=i.split(":"),e.getControl(i[0]).set(i[1],r)):e.getControl(i).set("data",r)})},setOpenHandler:function(t){this.openHandler=t,t!==null?this.$openbtn.show():this.$openbtn.hide()},getOpenHandler:function(){return this.openHandler}});b.Tab=u,b.Indicator=f;var m=PhpDebugBar.AjaxHandler=function(t,e,i){this.debugbar=t,this.headerName=e||"phpdebugbar",this.autoShow=typeof i>"u"?!0:i};a.extend(m.prototype,{handle:function(t){return this.isFetch(t)&&!t.headers.has(this.headerName+"-id")||this.isXHR(t)&&t.getAllResponseHeaders().indexOf(this.headerName)===-1||this.loadFromId(t)?!0:this.loadFromData(t)},getHeader:function(t,e){return this.isFetch(t)?t.headers.get(e):t.getResponseHeader(e)},isFetch:function(t){return Object.prototype.toString.call(t)=="[object Response]"},isXHR:function(t){return Object.prototype.toString.call(t)=="[object XMLHttpRequest]"},loadFromId:function(t){var e=this.extractIdFromHeaders(t);return e&&this.debugbar.openHandler?(this.debugbar.loadDataSet(e,"(ajax)",void 0,this.autoShow),!0):!1},extractIdFromHeaders:function(t){return this.getHeader(t,this.headerName+"-id")},loadFromData:function(t){var e=this.extractDataFromHeaders(t);if(!e)return!1;var i=this.parseHeaders(e);if(i.error)throw new Error("Error loading debugbar data: "+i.error);return i.data&&this.debugbar.addDataSet(i.data,i.id,"(ajax)",this.autoShow),!0},extractDataFromHeaders:function(t){var e=this.getHeader(t,this.headerName);if(e){for(var i=1;;i++){var s=this.getHeader(t,this.headerName+"-"+i);if(!s)break;e+=s}return decodeURIComponent(e)}},parseHeaders:function(t){return JSON.parse(t)},bindToFetch:function(){var t=this,e=window.fetch;e!==void 0&&e.polyfill!==void 0||(window.fetch=function(){var i=e.apply(this,arguments);return i.then(function(s){t.handle(s)}).catch(function(s){}),i})},bindToJquery:function(t){var e=this;t(document).ajaxComplete(function(i,s,r){r.ignoreDebugBarAjaxHandler||e.handle(s)})},bindToXHR:function(){var t=this,e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(i,s,r,o,d){var h=this;this.addEventListener("readystatechange",function(){var v=t.debugbar.openHandler?t.debugbar.openHandler.get("url"):null,$=typeof s=="string"?s:s.href;h.readyState==4&&$.indexOf(v)!==0&&t.handle(h)},!1),e.apply(this,Array.prototype.slice.call(arguments))}}})})(PhpDebugBar.$);
